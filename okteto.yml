build:
  hello-world:
    context: .
    image: ifbyol/pipeline-runner:go-getting-started

deploy:
  remote: true
  commands:
    - echo $OKTETO_CURRENT_DEPLOY_BELONGS_TO_PREVIEW
    - kubectl apply -f k8s.yml
    - trivy image ifbyol/pipeline-runner:go-getting-started

destroy:
  remote: true
  commands:
    - echo "destroying...."
    - kubectl get deployment
    - sleep 5s
dev:
  hello-world:
    image: okteto/golang:1
    command: bash
    sync:
      - .:/usr/src/app
    volumes:
      - /go
      - /root/.cache
    securityContext:
      capabilities:
        add:
          - SYS_PTRACE
    forward:
      - 2345:2345
